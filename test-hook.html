<!DOCTYPE html>
<html>
<head>
    <title>Test Hook</title>
</head>
<body>
    <h1>Test Hook</h1>
    <div id="result"></div>
    
    <script>
        async function testHook() {
            const clinicId = '50700388-9022-46bf-ace0-8e2335b744bb';
            const url = `http://localhost:5000/api/clinics/${clinicId}/reviews?status=approved&limit=1000`;
            
            try {
                console.log('üîç Testing hook logic:', url);
                const response = await fetch(url);
                console.log('üîç Response status:', response.status);
                
                const data = await response.json();
                console.log('üîç Response data:', data);
                
                const reviews = data.reviews || [];
                console.log('üîç Reviews:', reviews);
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
                const approvedReviews = reviews.filter(review => review.status === 'approved');
                console.log('üîç Approved reviews:', approvedReviews);
                
                if (approvedReviews.length === 0) {
                    console.log('üîç No approved reviews, returning hasRating: false');
                    document.getElementById('result').innerHTML = `
                        <h2>No approved reviews</h2>
                        <p>Total reviews: ${reviews.length}</p>
                        <p>Approved reviews: ${approvedReviews.length}</p>
                    `;
                    return;
                }
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                const totalQuality = approvedReviews.reduce((sum, review) => sum + Number(review.qualityRating), 0);
                const totalService = approvedReviews.reduce((sum, review) => sum + Number(review.serviceRating), 0);
                const totalComfort = approvedReviews.reduce((sum, review) => sum + Number(review.comfortRating), 0);
                const totalPrice = approvedReviews.reduce((sum, review) => sum + Number(review.priceRating), 0);
                const totalAverage = approvedReviews.reduce((sum, review) => sum + Number(review.averageRating), 0);
                
                const count = approvedReviews.length;
                
                const result = {
                    hasRating: true,
                    qualityRating: totalQuality / count,
                    serviceRating: totalService / count,
                    comfortRating: totalComfort / count,
                    priceRating: totalPrice / count,
                    averageRating: totalAverage / count,
                    totalReviews: count
                };
                
                console.log('üîç Calculated result:', result);
                
                document.getElementById('result').innerHTML = `
                    <h2>Success!</h2>
                    <p>Total reviews: ${reviews.length}</p>
                    <p>Approved reviews: ${approvedReviews.length}</p>
                    <p>Quality: ${result.qualityRating.toFixed(1)}</p>
                    <p>Service: ${result.serviceRating.toFixed(1)}</p>
                    <p>Comfort: ${result.comfortRating.toFixed(1)}</p>
                    <p>Price: ${result.priceRating.toFixed(1)}</p>
                    <p>Average: ${result.averageRating.toFixed(1)}</p>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = `<h2>Error: ${error.message}</h2>`;
            }
        }
        
        testHook();
    </script>
</body>
</html>
