<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
        .instructions { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è Service Worker</h1>
    
    <div class="instructions">
        <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <ol>
            <li><strong>–û—Ç–∫—Ä–æ–π—Ç–µ DevTools</strong> (F12)</li>
            <li><strong>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Application ‚Üí Storage</strong></li>
            <li><strong>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Cache Storage</strong> - —Ç–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–µ—à–∏</li>
            <li><strong>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</strong> –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑</li>
            <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è</strong></li>
        </ol>
    </div>

    <div class="test-section info">
        <h3>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker</h3>
        <button onclick="checkServiceWorker()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Service Worker</button>
        <div id="sw-status" class="log"></div>
    </div>

    <div class="test-section info">
        <h3>üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞</h3>
        <button onclick="checkCache()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à</button>
        <div id="cache-status" class="log"></div>
    </div>

    <div class="test-section info">
        <h3>üß™ –¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        <button onclick="testCaching()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        <div id="test-results" class="log"></div>
    </div>

    <div class="test-section info">
        <h3>üì± –¢–µ—Å—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º</h3>
        <div class="instructions">
            <p><strong>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º:</strong></p>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
                <li>–ü—Ä–æ–π–¥–∏—Ç–µ—Å—å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º</li>
                <li>–ó–∞–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä</li>
                <li>–ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã</li>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —Å–Ω–æ–≤–∞</li>
                <li><strong>–°–∞–π—Ç –ù–ï –¥–æ–ª–∂–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è!</strong></li>
            </ol>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
        async function checkServiceWorker() {
            const statusDiv = document.getElementById('sw-status');
            statusDiv.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º Service Worker...';

            try {
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        statusDiv.textContent = `‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!\n\n–ê–∫—Ç–∏–≤–Ω—ã–π: ${registration.active ? '–î–∞' : '–ù–µ—Ç'}\n–û–∂–∏–¥–∞—é—â–∏–π: ${registration.waiting ? '–î–∞' : '–ù–µ—Ç'}\n–û–±–ª–∞—Å—Ç—å: ${registration.scope}`;
                        statusDiv.parentElement.className = 'test-section success';
                    } else {
                        statusDiv.textContent = '‚ùå Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω';
                        statusDiv.parentElement.className = 'test-section error';
                    }
                } else {
                    statusDiv.textContent = '‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º';
                    statusDiv.parentElement.className = 'test-section error';
                }
            } catch (error) {
                statusDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                statusDiv.parentElement.className = 'test-section error';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
        async function checkCache() {
            const statusDiv = document.getElementById('cache-status');
            statusDiv.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à...';

            try {
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    let cacheInfo = `‚úÖ Cache API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n\n–ù–∞–π–¥–µ–Ω–æ –∫–µ—à–µ–π: ${cacheNames.length}\n\n`;
                    
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        const keys = await cache.keys();
                        cacheInfo += `üìÅ ${cacheName}: ${keys.length} —Ñ–∞–π–ª–æ–≤\n`;
                    }
                    
                    statusDiv.textContent = cacheInfo;
                    statusDiv.parentElement.className = 'test-section success';
                } else {
                    statusDiv.textContent = '‚ùå Cache API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º';
                    statusDiv.parentElement.className = 'test-section error';
                }
            } catch (error) {
                statusDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                statusDiv.parentElement.className = 'test-section error';
            }
        }

        // –¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
        async function testCaching() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.textContent = '–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è...';

            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É API
                const apiResponse = await fetch('/api/cities');
                const apiData = await apiResponse.json();
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
                const staticResponse = await fetch('/assets/index.css');
                
                let results = 'üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:\n\n';
                results += `‚úÖ API –∑–∞–ø—Ä–æ—Å: ${apiResponse.status} (${apiData.length} –≥–æ—Ä–æ–¥–æ–≤)\n`;
                results += `‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—É—Ä—Å: ${staticResponse.status}\n\n`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–æ–≤
                const cacheNames = await caches.keys();
                results += `üìä –ö–µ—à–µ–π –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–æ–≤: ${cacheNames.length}\n`;
                
                for (const cacheName of cacheNames) {
                    const cache = await caches.open(cacheName);
                    const keys = await cache.keys();
                    results += `üìÅ ${cacheName}: ${keys.length} —Ñ–∞–π–ª–æ–≤\n`;
                }
                
                results += '\nüí° –¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ DevTools ‚Üí Application ‚Üí Storage';
                
                resultsDiv.textContent = results;
                resultsDiv.parentElement.className = 'test-section success';
            } catch (error) {
                resultsDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${error.message}`;
                resultsDiv.parentElement.className = 'test-section error';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkServiceWorker();
            checkCache();
        });
    </script>
</body>
</html>
