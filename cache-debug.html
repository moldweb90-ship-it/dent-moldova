<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –∫–µ—à–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .info { background-color: #d1ecf1; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç –û—Ç–ª–∞–¥–∫–∞ –∫–µ—à–∞</h1>
    
    <div class="debug info">
        <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞ –≤ DevTools:</h3>
        <div class="log">
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Application ‚Üí Storage
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Cache Storage
4. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–µ—à–∏: static-v1, api-v1, pages-v1
5. –í –∫–∞–∂–¥–æ–º –∫–µ—à–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã

–ï—Å–ª–∏ –∫–µ—à–∏ –ø—É—Å—Ç—ã–µ - Service Worker –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ï—Å–ª–∏ –∫–µ—à–∏ –µ—Å—Ç—å - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
        </div>
    </div>

    <div class="debug">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker</h3>
        <button onclick="debugServiceWorker()">–û—Ç–ª–∞–¥–∫–∞ SW</button>
        <div id="sw-debug" class="log"></div>
    </div>

    <div class="debug">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–µ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h3>
        <button onclick="debugCaches()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à–∏</button>
        <div id="cache-debug" class="log"></div>
    </div>

    <div class="debug">
        <h3>3. –¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
        <button onclick="debugRequests()">–¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–æ–≤</button>
        <div id="request-debug" class="log"></div>
    </div>

    <script>
        // –û—Ç–ª–∞–¥–∫–∞ Service Worker
        async function debugServiceWorker() {
            const debugDiv = document.getElementById('sw-debug');
            let output = 'üîç –û—Ç–ª–∞–¥–∫–∞ Service Worker:\n\n';

            try {
                if ('serviceWorker' in navigator) {
                    output += '‚úÖ Service Worker –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                    
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        output += `‚úÖ SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω\n`;
                        output += `Scope: ${registration.scope}\n`;
                        output += `Active: ${registration.active ? '–î–∞' : '–ù–µ—Ç'}\n`;
                        output += `State: ${registration.active?.state || '–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω'}\n`;
                        
                        if (registration.active) {
                            output += `Script URL: ${registration.active.scriptURL}\n`;
                        }
                    } else {
                        output += '‚ùå SW –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω\n';
                    }
                } else {
                    output += '‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                }
            } catch (error) {
                output += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
            }

            debugDiv.textContent = output;
        }

        // –û—Ç–ª–∞–¥–∫–∞ –∫–µ—à–µ–π
        async function debugCaches() {
            const debugDiv = document.getElementById('cache-debug');
            let output = 'üîç –û—Ç–ª–∞–¥–∫–∞ –∫–µ—à–µ–π:\n\n';

            try {
                if ('caches' in window) {
                    output += '‚úÖ Cache API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                    
                    const cacheNames = await caches.keys();
                    output += `–ù–∞–π–¥–µ–Ω–æ –∫–µ—à–µ–π: ${cacheNames.length}\n\n`;
                    
                    for (const cacheName of cacheNames) {
                        output += `üìÅ –ö–µ—à: ${cacheName}\n`;
                        const cache = await caches.open(cacheName);
                        const keys = await cache.keys();
                        output += `  –§–∞–π–ª–æ–≤: ${keys.length}\n`;
                        
                        if (keys.length > 0) {
                            let totalSize = 0;
                            for (const request of keys.slice(0, 5)) { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5
                                try {
                                    const response = await cache.match(request);
                                    if (response) {
                                        const blob = await response.blob();
                                        totalSize += blob.size;
                                        output += `  - ${request.url} (${Math.round(blob.size/1024)}KB)\n`;
                                    }
                                } catch (e) {
                                    output += `  - ${request.url} (–æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è)\n`;
                                }
                            }
                            if (keys.length > 5) {
                                output += `  ... –∏ –µ—â–µ ${keys.length - 5} —Ñ–∞–π–ª–æ–≤\n`;
                            }
                            output += `  –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: ${Math.round(totalSize/1024)}KB\n`;
                        }
                        output += '\n';
                    }
                } else {
                    output += '‚ùå Cache API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n';
                }
            } catch (error) {
                output += `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
            }

            debugDiv.textContent = output;
        }

        // –û—Ç–ª–∞–¥–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
        async function debugRequests() {
            const debugDiv = document.getElementById('request-debug');
            let output = 'üîç –û—Ç–ª–∞–¥–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:\n\n';

            try {
                const tests = [
                    { name: 'API –≥–æ—Ä–æ–¥–æ–≤', url: '/api/cities' },
                    { name: 'API –∫–ª–∏–Ω–∏–∫', url: '/api/clinics' }
                ];

                for (const test of tests) {
                    output += `üì° ${test.name}:\n`;
                    
                    try {
                        const startTime = performance.now();
                        const response = await fetch(test.url);
                        const endTime = performance.now();
                        const duration = Math.round(endTime - startTime);
                        
                        output += `  –°—Ç–∞—Ç—É—Å: ${response.status}\n`;
                        output += `  –í—Ä–µ–º—è: ${duration}ms\n`;
                        output += `  –†–∞–∑–º–µ—Ä: ${response.headers.get('content-length') || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n`;
                        output += `  –ö–µ—à: ${response.headers.get('cache-control') || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –Ω–∞—à –∑–∞–≥–æ–ª–æ–≤–æ–∫
                        const swCacheDate = response.headers.get('sw-cache-date');
                        if (swCacheDate) {
                            output += `  SW –∫–µ—à: ${swCacheDate}\n`;
                        } else {
                            output += `  SW –∫–µ—à: –Ω–µ –Ω–∞–π–¥–µ–Ω\n`;
                        }
                        
                    } catch (error) {
                        output += `  ‚ùå –û—à–∏–±–∫–∞: ${error.message}\n`;
                    }
                    output += '\n';
                }
            } catch (error) {
                output += `‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞: ${error.message}\n`;
            }

            debugDiv.textContent = output;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                debugServiceWorker();
                debugCaches();
            }, 1000);
        });
    </script>
</body>
</html>
